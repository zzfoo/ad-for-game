!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.AFG={})}(this,function(t){"use strict";var o=Object.prototype.hasOwnProperty,f="~";function n(){}function d(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var r=new d(n,o||t,i),a=f?f+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],r]:t._events[a].push(r):(t._events[a]=r,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function e(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(f=!1)),e.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)o.call(t,e)&&n.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},e.prototype.listeners=function(t){var e=f?f+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,r=new Array(i);o<i;o++)r[o]=n[o].fn;return r},e.prototype.listenerCount=function(t){var e=f?f+t:t,n=this._events[e];return n?n.fn?1:n.length:0},e.prototype.emit=function(t,e,n,o,i,r){var a=f?f+t:t;if(!this._events[a])return!1;var d,s,u=this._events[a],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,o),!0;case 5:return u.fn.call(u.context,e,n,o,i),!0;case 6:return u.fn.call(u.context,e,n,o,i,r),!0}for(s=1,d=new Array(l-1);s<l;s++)d[s-1]=arguments[s];u.fn.apply(u.context,d)}else{var c,h=u.length;for(s=0;s<h;s++)switch(u[s].once&&this.removeListener(t,u[s].fn,void 0,!0),l){case 1:u[s].fn.call(u[s].context);break;case 2:u[s].fn.call(u[s].context,e);break;case 3:u[s].fn.call(u[s].context,e,n);break;case 4:u[s].fn.call(u[s].context,e,n,o);break;default:if(!d)for(c=1,d=new Array(l-1);c<l;c++)d[c-1]=arguments[c];u[s].fn.apply(u[s].context,d)}}return!0},e.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},e.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},e.prototype.removeListener=function(t,e,n,o){var i=f?f+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var r=this._events[i];if(r.fn)r.fn!==e||o&&!r.once||n&&r.context!==n||u(this,i);else{for(var a=0,d=[],s=r.length;a<s;a++)(r[a].fn!==e||o&&!r[a].once||n&&r[a].context!==n)&&d.push(r[a]);d.length?this._events[i]=1===d.length?d[0]:d:u(this,i)}return this},e.prototype.removeAllListeners=function(t){var e;return t?(e=f?f+t:t,this._events[e]&&u(this,e)):(this._events=new n,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=f,e.EventEmitter=e,"undefined"!=typeof module&&(module.exports=e);var r,a=(r=Object.freeze({}))&&r.default||r,s={LOADED:"loaded",LOAD_ERROR:"load_error",AD_START:"ad_start",AD_SKIPPED:"ad_skipped",AD_COMPLETE:"ad_complete",AD_END:"ad_end",AD_CLICKED:"ad_clicked"},l=function(){this.inited=!1},c={inited:null,options:null,_adIndex:null,_adCache:null,init:function(t,e){this._adCache={},this.options=t,this.doInit(e)},doInit:function(t){t&&setTimeout(function(){t&&t(null)},30)},doCreateAd:function(){return new p},createAd:function(t,e){var n=this.doCreateAd();return!!n&&(e=e||this.generateName(),n.init(e,this,t),this._adCache[e]=n)},getAd:function(t){return this._adCache[t]},destroyAd:function(t){delete this._adCache[t]},displayAd:function(t){},generateName:function(){return"ad_"+ ++this._adIndex}};for(var h in c)l.prototype[h]=c[h];var p=function(){a.call(this),this.destroyed=!1},m={name:null,manager:null,options:null,loaded:null,destroyed:null,init:function(t,e,n){this.manager=e,this.name=t,this.options=n,this.onInit()},onInit:function(){},load:function(){this.loaded=!1;var t=this;setTimeout(function(){t.loaded=!0,t.emit(s.LOADED)},30)},unload:function(){},onDestroy:function(){},refresh:function(){this.load()},show:function(){this.emit(s.AD_START);var t=this;setTimeout(function(){t.emit(s.AD_COMPLETE),t.emit(s.AD_END)},30)},destroy:function(){var t=this.manager;this.name=null,this.options=null,this.manager=null,this.unload(),this.onDestroy(),this.removeAllListeners(),t.destroyAd(this),this.destroyed=!0}};for(var h in a.prototype)p.prototype[h]=a.prototype[h];for(var h in m)p.prototype[h]=m[h];var A,_={EVENTS:s,AdManager:l,Ad:p},v=_.EVENTS,g=_.AdManager,y=_.Ad,E=function(){g.call(this)},D={_adsLoader:null,_containerElement:null,doInit:function(e){var t=this;window.adsbygoogle=window.adsbygoogle||[],function(t,e,n){var o=document.createElement("script");o.async=!0;var i=!1;o.onload=function(t){i||(i=!0,e&&e(t))},o.onerror=function(t){n&&n(t)};var r=document.head||document.getElementsByTagName("head")[0]||document.documentElement;r.insertBefore(o,r.firstChild),o.src=t}("//imasdk.googleapis.com/js/sdkloader/ima3.js",function(){A=window.google,t._initAdLoader(),t.inited=!0,e&&e(null)},function(t){e(t)})},doCreateAd:function(){return new T},displayAd:function(t){this._displayContainerElement(!0)},loadAd:function(t){var e=t.options,n=e.descriptionPage||window.location.href,o={ad_type:e.adType,client:e.id,description_url:n,videoad_start_delay:e.delay||0,hl:e.language||"en"};e.channel&&(o.channel=e.channel),e.adDuration&&(o.max_ad_duration=e.adDuration),e.skippableAdDuration&&(o.sdmax=e.skippableAdDuration);var i=[];for(var r in o)i.push(r+"="+encodeURIComponent(o[r]));var a="https://googleads.g.doubleclick.net/pagead/ads?"+i.join("&"),d=e.width||window.innerWidth,s=e.height||window.innerHeight;e.width=d,e.height=s;var u=new A.ima.AdsRequest;u.adTagUrl=a,u.forceNonLinearFullSlot=!0,u.linearAdSlotWidth=d,u.linearAdSlotHeight=s,u.nonLinearAdSlotWidth=d,u.nonLinearAdSlotHeight=s,(e.vastLoadTimeout||0===e.vastLoadTimeout)&&(u.vastLoadTimeout=e.vastLoadTimeout);var l=new A.ima.AdsRenderingSettings;l.restoreCustomPlaybackStateOnAdBreakComplete=!0,l.useStyledNonLinearAds=!1,l.useStyledLinearAds=!1,this._adsLoader.requestAds(u,{name:t.name})},_initAdLoader:function(){var t=this.options,e=this._createAdDisplayContainer(t),n=this._adsLoader=new A.ima.AdsLoader(e),i=this;n.addEventListener(A.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(t){var e=t.getUserRequestContext().name,n=i.getAd(e);if(n){var o=t.getAdsManager({currentTime:0,duration:600},n.adsRenderingSettings);n._onAdsManagerLoaded(o),n.once(v.AD_END,function(){i._onAdClosed(e),n.autoDestroy&&n.destroy()})}},!1),n.addEventListener(A.ima.AdErrorEvent.Type.AD_ERROR,function(t){var e=t.getUserRequestContext().name,n=i.getAd(e);if(n){var o=t.getError();n._onAdsLoadError(o)}},!1)},_createAdDisplayContainer:function(t){var e,n;for(var o in t&&(e=t.containerElement,n=t.containerStyle),e?"string"==typeof e&&(e=document.getElementById(e)):e=this._createContainerElement(),n)e.style[o]=n[o];this._containerElement=e,this._displayContainerElement(!1);var i=new A.ima.AdDisplayContainer(e);return i.initialize(),i},_createContainerElement:function(){var t=document.createElement("div"),e=window.innerWidth,n=window.innerHeight,o=t.style,i={position:"absolute",top:"0px",left:"0px",backgroundColor:"rgba(0,0,0,0.75)",width:e+"px",height:n+"px","z-index":9e9};for(var r in i)o[r]=i[r];return document.body.appendChild(t),t},_displayContainerElement:function(t){this._containerElement.style.display=t?"block":"none"},_onAdClosed:function(t){this._displayContainerElement(!1)}};for(var L in g.prototype)E.prototype[L]=g.prototype[L];for(var L in D)E.prototype[L]=D[L];var T=function(){y.call(this)},C={_adsManager:null,adsRenderingSettings:null,_timeoutId:null,autoDestroy:null,timeout:null,onInit:function(){var t=this.options;this.adsRenderingSettings=t.adsRenderingSettings,this.autoDestroy=t.autoDestroy,this.destroyed=!1},refresh:function(){this.clearTimeout(),this.load()},clearTimeout:function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},load:function(){var t=this.options;this.loaded=!1,this._adsManager=null,this.manager.loadAd(this);var e=t.timeout;e&&(this._timeoutId=setTimeout(function(){this._timeoutId=null,this._onLoadTimeout()}.bind(this),e))},show:function(){var t=this._adsManager;if(!t)return!1;this.manager.displayAd(this);var e=this.options;return t.init(e.width,e.height,A.ima.ViewMode.NORMAL),t.start(),!0},_onLoadTimeout:function(){this.emit(v.LOAD_ERROR,"load timeout!"),this.destroy()},_onAdsManagerLoaded:function(t){if(!this.destroyed){this.loaded=!0,this._adsManager=t;var e=this,n=A.ima.AdEvent.Type;this.emit(v.LOADED),t.addEventListener(n.STARTED,function(){e.emit(v.AD_START)}),t.addEventListener(n.COMPLETE,function(){e.emit(v.AD_COMPLETE),e.emit(v.AD_END)});var o=!1;t.addEventListener(n.SKIPPED,function(){o=!0,e.emit(v.AD_SKIPPED),e.emit(v.AD_END)}),t.addEventListener(n.USER_CLOSE,function(){setTimeout(function(){o||(e.emit(v.AD_COMPLETE),e.emit(v.AD_END))},100)}),t.addEventListener(n.CLICK,function(){e.emit(v.AD_CLICKED)}),this.clearTimeout()}},_onAdsLoadError:function(t){this.destroyed||(this.clearTimeout(),this.emit(v.LOAD_ERROR,t),this.destroy())},unload:function(){this._adsManager&&this._adsManager.destroy(),this._adsManager=null,this.adsRenderingSettings=null}};for(var L in y.prototype)T.prototype[L]=y.prototype[L];for(var L in C)T.prototype[L]=C[L];var w={GoogleAdManager:E,GoogleAd:T},S=_.EVENTS,M=_.AdManager,R=_.Ad,I=function(){M.call(this)},O={adSingleton:null,adUnitId:null,currentAd:null,doInit:function(t,e){this.adUnitId=t.adUnitId,setTimeout(function(){e(null)},30)},displayAd:function(t){this.adSingleton.show()},doCreateAd:function(){return new b},_initAdSingleton:function(){var e=this,t=this.adSingleton=wx.createRewardedVideoAd({adUnitId:this.adUnitId});t.onLoad(function(){e.currentAd.onLoaded()}),t.onError(function(t){e.currentAd.onLoadError(t)}),t.onClose(function(t){t&&t.isEnded||void 0===t?e.currentAd.onComplete():e.currentAd.onSkipped()})},loadAd:function(t){this.currentAd=t,this.adSingleton||this._initAdSingleton()}};for(var x in M.prototype)I.prototype[x]=M.prototype[x];for(var x in O)I.prototype[x]=O[x];var b=function(){R.call(this)},N={_timeoutId:null,timeout:null,refresh:function(){this.clearTimeout(),this.load()},load:function(){var t=this.options;this.loaded=!1,this.manager.loadAd(this);var e=t.timeout;e&&(this._timeoutId=setTimeout(function(){this._timeoutId=null,this.onLoadTimeout()}.bind(this),e))},clearTimeout:function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},unload:function(){this.loaded=!1},show:function(){return this.manager.displayAd(),!0},onLoaded:function(){this.loaded=!0,this.clearTimeout(),this.emit(S.LOADED)},onLoadError:function(t){this.clearTimeout(),this.emit(S.LOAD_ERROR,t.errMsg)},onSkipped:function(){this.emit(S.AD_SKIPPED),this.emit(S.AD_END)},onComplete:function(){this.emit(S.AD_COMPLETE),this.emit(S.AD_END)},onLoadTimeout:function(){this.emit(S.LOAD_ERROR,"load timeout!")}};for(var x in R.prototype)b.prototype[x]=R.prototype[x];for(var x in N)b.prototype[x]=N[x];var P={WechatAdManager:I,WechatAd:b},k={EVENTS:_.EVENTS,AdManager:_.AdManager,Ad:_.Ad,GoogleAdManager:w.GoogleAdManager,GoogleAd:w.GoogleAd,WechatAdManager:P.WechatAdManager,WechatAd:P.WechatAd},W=k.EVENTS,G=k.AdManager,j=k.Ad,U=k.GoogleAdManager,V=k.GoogleAd,K=k.WechatAdManager,q=k.WechatAd;t.default=k,t.EVENTS=W,t.AdManager=G,t.Ad=j,t.GoogleAdManager=U,t.GoogleAd=V,t.WechatAdManager=K,t.WechatAd=q,Object.defineProperty(t,"__esModule",{value:!0})});