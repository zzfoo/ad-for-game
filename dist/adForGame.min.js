!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("eventemitter3")):"function"==typeof define&&define.amd?define(["exports","eventemitter3"],e):e(t.AFG={},t.eventemitter3)}(this,function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var n={LOADED:"loaded",LOAD_ERROR:"load_error",AD_START:"ad_start",AD_SKIPPED:"ad_skipped",AD_COMPLETE:"ad_complete",AD_END:"ad_end",AD_CLICKED:"ad_clicked"},i=function(){this.inited=!1},o={inited:null,options:null,_adIndex:null,_adCache:null,init:function(t,e){this._adCache={},this.options=t,this.doInit(e)},doInit:function(t){t&&setTimeout(function(){t&&t(null)},30)},doCreateAd:function(){return new d},createAd:function(t,e){var n=this.doCreateAd();return!!n&&(e=e||this.generateName(),n.init(e,this,t),this._adCache[e]=n)},getAd:function(t){return this._adCache[t]},destroyAd:function(t){delete this._adCache[t]},displayAd:function(t){},generateName:function(){return"ad_"+ ++this._adIndex}};for(var a in o)i.prototype[a]=o[a];var d=function(){e.call(this),this.destroyed=!1},r={name:null,manager:null,options:null,loaded:null,destroyed:null,init:function(t,e,n){this.manager=e,this.name=t,this.options=n,this.onInit()},onInit:function(){},load:function(){this.loaded=!1;var t=this;setTimeout(function(){t.loaded=!0,t.emit(n.LOADED)},30)},unload:function(){},onDestroy:function(){},refresh:function(){this.load()},show:function(){this.emit(n.AD_START);var t=this;setTimeout(function(){t.emit(n.AD_COMPLETE),t.emit(n.AD_END)},30)},destroy:function(){var t=this.manager;this.name=null,this.options=null,this.manager=null,this.unload(),this.onDestroy(),this.removeAllListeners(),t.destroyAd(this),this.destroyed=!0}};for(var a in e.prototype)d.prototype[a]=e.prototype[a];for(var a in r)d.prototype[a]=r[a];var h,s={EVENTS:n,AdManager:i,Ad:d},u=s.EVENTS,l=s.AdManager,c=s.Ad,m=function(){l.call(this)},A={_adsLoader:null,_containerElement:null,doInit:function(e){var t=this;window.adsbygoogle=window.adsbygoogle||[],function(t,e,n){var i=document.createElement("script");i.async=!0;var o=!1;i.onload=function(t){o||(o=!0,e&&e(t))},i.onerror=function(t){n&&n(t)};var a=document.head||document.getElementsByTagName("head")[0]||document.documentElement;a.insertBefore(i,a.firstChild),i.src=t}("//imasdk.googleapis.com/js/sdkloader/ima3.js",function(){h=window.google,t._initAdLoader(),t.inited=!0,e&&e(null)},function(t){e(t)})},doCreateAd:function(){return new p},displayAd:function(t){this._displayContainerElement(!0)},loadAd:function(t){var e=t.options,n=e.descriptionPage||window.location.href,i={ad_type:e.adType,client:e.id,description_url:n,videoad_start_delay:e.delay||0,hl:e.language||"en"};e.channel&&(i.channel=e.channel),e.adDuration&&(i.max_ad_duration=e.adDuration),e.skippableAdDuration&&(i.sdmax=e.skippableAdDuration);var o=[];for(var a in i)o.push(a+"="+encodeURIComponent(i[a]));var d="https://googleads.g.doubleclick.net/pagead/ads?"+o.join("&"),r=e.width||window.innerWidth,s=e.height||window.innerHeight;e.width=r,e.height=s;var u=new h.ima.AdsRequest;u.adTagUrl=d,u.forceNonLinearFullSlot=!0,u.linearAdSlotWidth=r,u.linearAdSlotHeight=s,u.nonLinearAdSlotWidth=r,u.nonLinearAdSlotHeight=s,(e.vastLoadTimeout||0===e.vastLoadTimeout)&&(u.vastLoadTimeout=e.vastLoadTimeout);var l=new h.ima.AdsRenderingSettings;l.restoreCustomPlaybackStateOnAdBreakComplete=!0,l.useStyledNonLinearAds=!1,l.useStyledLinearAds=!1,this._adsLoader.requestAds(u,{name:t.name})},_initAdLoader:function(){var t=this.options,e=this._createAdDisplayContainer(t),n=this._adsLoader=new h.ima.AdsLoader(e),o=this;n.addEventListener(h.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(t){var e=t.getUserRequestContext().name,n=o.getAd(e);if(n){var i=t.getAdsManager({currentTime:0,duration:600},n.adsRenderingSettings);n._onAdsManagerLoaded(i),n.once(u.AD_END,function(){o._onAdClosed(e),n.autoDestroy&&n.destroy()})}},!1),n.addEventListener(h.ima.AdErrorEvent.Type.AD_ERROR,function(t){var e=t.getUserRequestContext().name,n=o.getAd(e);if(n){var i=t.getError();n._onAdsLoadError(i)}},!1)},_createAdDisplayContainer:function(t){var e,n;for(var i in t&&(e=t.containerElement,n=t.containerStyle),e?"string"==typeof e&&(e=document.getElementById(e)):e=this._createContainerElement(),n)e.style[i]=n[i];this._containerElement=e,this._displayContainerElement(!1);var o=new h.ima.AdDisplayContainer(e);return o.initialize(),o},_createContainerElement:function(){var t=document.createElement("div"),e=window.innerWidth,n=window.innerHeight,i=t.style,o={position:"absolute",top:"0px",left:"0px",backgroundColor:"rgba(0,0,0,0.75)",width:e+"px",height:n+"px","z-index":9e9};for(var a in o)i[a]=o[a];return document.body.appendChild(t),t},_displayContainerElement:function(t){this._containerElement.style.display=t?"block":"none"},_onAdClosed:function(t){this._displayContainerElement(!1)}};for(var f in l.prototype)m.prototype[f]=l.prototype[f];for(var f in A)m.prototype[f]=A[f];var p=function(){c.call(this)},g={_adsManager:null,adsRenderingSettings:null,_timeoutId:null,autoDestroy:null,timeout:null,onInit:function(){var t=this.options;this.adsRenderingSettings=t.adsRenderingSettings,this.autoDestroy=t.autoDestroy,this.destroyed=!1},refresh:function(){this.clearTimeout(),this.load()},clearTimeout:function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},load:function(){var t=this.options;this.loaded=!1,this._adsManager=null,this.manager.loadAd(this);var e=t.timeout;e&&(this._timeoutId=setTimeout(function(){this._timeoutId=null,this._onLoadTimeout()}.bind(this),e))},show:function(){var t=this._adsManager;if(!t)return!1;this.manager.displayAd(this);var e=this.options;return t.init(e.width,e.height,h.ima.ViewMode.NORMAL),t.start(),!0},_onLoadTimeout:function(){this.emit(u.LOAD_ERROR,"load timeout!"),this.destroy()},_onAdsManagerLoaded:function(t){if(!this.destroyed){this.loaded=!0,this._adsManager=t;var e=this,n=h.ima.AdEvent.Type;this.emit(u.LOADED),t.addEventListener(n.STARTED,function(){e.emit(u.AD_START)}),t.addEventListener(n.COMPLETE,function(){e.emit(u.AD_COMPLETE),e.emit(u.AD_END)});var i=!1;t.addEventListener(n.SKIPPED,function(){i=!0,e.emit(u.AD_SKIPPED),e.emit(u.AD_END)}),t.addEventListener(n.USER_CLOSE,function(){setTimeout(function(){i||(e.emit(u.AD_COMPLETE),e.emit(u.AD_END))},100)}),t.addEventListener(n.CLICK,function(){e.emit(u.AD_CLICKED)}),this.clearTimeout()}},_onAdsLoadError:function(t){this.destroyed||(this.clearTimeout(),this.emit(u.LOAD_ERROR,t),this.destroy())},unload:function(){this._adsManager&&this._adsManager.destroy(),this._adsManager=null,this.adsRenderingSettings=null}};for(var f in c.prototype)p.prototype[f]=c.prototype[f];for(var f in g)p.prototype[f]=g[f];var _={GoogleAdManager:m,GoogleAd:p},E=s.EVENTS,y=s.AdManager,v=s.Ad,D=function(){y.call(this)},L={adSingleton:null,adUnitId:null,currentAd:null,doInit:function(t,e){this.adUnitId=t.adUnitId,setTimeout(function(){e(null)},30)},displayAd:function(t){this.adSingleton.show()},doCreateAd:function(){return new C},_initAdSingleton:function(){var e=this,t=this.adSingleton=wx.createRewardedVideoAd({adUnitId:this.adUnitId});t.onLoad(function(){e.currentAd.onLoaded()}),t.onError(function(t){e.currentAd.onLoadError(t)}),t.onClose(function(t){t&&t.isEnded||void 0===t?e.currentAd.onComplete():e.currentAd.onSkipped()})},loadAd:function(t){this.currentAd=t,this.adSingleton||this._initAdSingleton()}};for(var T in y.prototype)D.prototype[T]=y.prototype[T];for(var T in L)D.prototype[T]=L[T];var C=function(){v.call(this)},S={_timeoutId:null,timeout:null,refresh:function(){this.clearTimeout(),this.load()},load:function(){var t=this.options;this.loaded=!1,this.manager.loadAd(this);var e=t.timeout;e&&(this._timeoutId=setTimeout(function(){this._timeoutId=null,this.onLoadTimeout()}.bind(this),e))},clearTimeout:function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},unload:function(){this.loaded=!1},show:function(){return this.manager.displayAd(),!0},onLoaded:function(){this.loaded=!0,this.clearTimeout(),this.emit(E.LOADED)},onLoadError:function(t){this.clearTimeout(),this.emit(E.LOAD_ERROR,t.errMsg)},onSkipped:function(){this.emit(E.AD_SKIPPED),this.emit(E.AD_END)},onComplete:function(){this.emit(E.AD_COMPLETE),this.emit(E.AD_END)},onLoadTimeout:function(){this.emit(E.LOAD_ERROR,"load timeout!")}};for(var T in v.prototype)C.prototype[T]=v.prototype[T];for(var T in S)C.prototype[T]=S[T];var M={WechatAdManager:D,WechatAd:C},R={EVENTS:s.EVENTS,AdManager:s.AdManager,Ad:s.Ad,GoogleAdManager:_.GoogleAdManager,GoogleAd:_.GoogleAd,WechatAdManager:M.WechatAdManager,WechatAd:M.WechatAd},w=R.EVENTS,I=R.AdManager,O=R.Ad,N=R.GoogleAdManager,P=R.GoogleAd,b=R.WechatAdManager,x=R.WechatAd;t.default=R,t.EVENTS=w,t.AdManager=I,t.Ad=O,t.GoogleAdManager=N,t.GoogleAd=P,t.WechatAdManager=b,t.WechatAd=x,Object.defineProperty(t,"__esModule",{value:!0})});